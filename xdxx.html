<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>XDXX - Canales XXX en Vivo 24/7</title>

  <!-- Plyr (reproductor moderno y sexy) -->
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

  <!-- HLS.js para soporte de streams -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: system-ui, sans-serif;
      background: #000;
      color: #eee;
      min-height: 100vh;
    }

    /* AGE GATE */
    #age-gate {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.97);
      backdrop-filter: blur(12px);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .age-box {
      background: rgba(15,15,20,0.92);
      border: 3px solid #ff0066;
      border-radius: 20px;
      padding: 4rem 2.5rem;
      text-align: center;
      max-width: 520px;
      box-shadow: 0 0 80px rgba(255,0,102,0.45);
    }

    .age-box h1 {
      font-size: 7rem;
      color: #ff0066;
      margin-bottom: 1rem;
      letter-spacing: -4px;
      text-shadow: 0 0 30px #ff0066aa;
    }

    .age-box p {
      font-size: 1.5rem;
      margin: 1.8rem 0 3rem;
      line-height: 1.5;
    }

    .age-btn {
      padding: 1.3rem 4rem;
      font-size: 1.5rem;
      font-weight: bold;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      margin: 1rem;
    }

    #enter { background: #ff0066; color: white; }
    #enter:hover { background: #e6005c; transform: scale(1.08); box-shadow: 0 0 40px #ff0066aa; }

    #exit { background: #222; color: #ccc; }
    #exit:hover { background: #333; color: white; transform: scale(1.05); }

    /* CONTENIDO PRINCIPAL */
    #main-content { display: none; padding: 2rem; max-width: 1800px; margin: 0 auto; }

    h1 {
      text-align: center;
      color: #ff0066;
      font-size: 4.5rem;
      margin: 1rem 0 2.5rem;
      text-shadow: 0 0 25px #ff0066aa;
    }

    #player-wrapper {
      position: relative;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto 4rem;
      background: #0a0a0a;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 60px rgba(255,0,102,0.35);
    }

    .plyr { width: 100%; aspect-ratio: 16/9; }

    .category-title {
      color: #ff0066;
      font-size: 2.5rem;
      margin: 4rem 0 1.5rem;
      border-bottom: 3px solid #222;
      padding-bottom: 1rem;
    }

    .channel-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
    }

    .channel-card {
      background: #111;
      border-radius: 14px;
      overflow: hidden;
      border: 3px solid transparent;
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
    }

    .channel-card:hover {
      transform: scale(1.07);
      border-color: #ff0066;
      box-shadow: 0 0 35px rgba(255,0,102,0.6);
    }

    .channel-card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
    }

    .channel-card .title {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
      padding: 1.2rem 1rem 0.8rem;
      font-size: 1.2rem;
      text-align: center;
      text-shadow: 0 0 10px black;
    }

    .active {
      border-color: #ff0066 !important;
      box-shadow: 0 0 50px #ff0066cc !important;
      transform: scale(1.1);
    }

    .warning {
      text-align: center;
      color: #ff9800;
      font-size: 1.3rem;
      margin: 3rem 0;
    }
  </style>
</head>
<body>

<!-- AGE GATE -->
<div id="age-gate">
  <div class="age-box">
    <h1>XDXX</h1>
    <h1>18+</h1>
    <p>Contenido explícito solo para mayores de edad.<br>
       Confirma que tienes 18 años o más según las leyes de tu país.</p>

    <button class="age-btn" id="enter">Soy mayor de 18 - Entrar a XDXX</button>
    <button class="age-btn" id="exit">No tengo 18 años / Salir</button>
  </div>
</div>

<!-- CONTENIDO PRINCIPAL -->
<div id="main-content">
  <h1>XDXX - Canales XXX en Vivo</h1>

  <div id="player-wrapper">
    <video id="player" playsinline controls></video>
  </div>

  <div id="categories"></div>

  <p class="warning">Solo para adultos • Contenido +18 • Responsabilidad propia</p>
</div>

<script>
const player = new Plyr('#player', {
  controls: ['play-large', 'restart', 'rewind', 'play', 'fast-forward', 'progress', 'current-time', 'duration', 'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen'],
  invertTime: false,
  toggleInvert: false,
  tooltips: { seek: true, scrub: true }
});

const categoriesContainer = document.getElementById('categories');

// Cargar JSON y canales
async function loadChannels() {
  try {
    const response = await fetch('https://canales-ngmh.vercel.app/liv3xdxx.json');
    if (!response.ok) throw new Error('Error cargando lista');
    const data = await response.json();

    data.categorias.forEach(categoria => {
      const title = document.createElement('h2');
      title.className = 'category-title';
      title.textContent = categoria.nombre;
      categoriesContainer.appendChild(title);

      const grid = document.createElement('div');
      grid.className = 'channel-grid';

      categoria.canales.forEach(channel => {
        const card = document.createElement('div');
        card.className = 'channel-card';
        card.innerHTML = `
          <img src="${channel.thumbnail || 'https://via.placeholder.com/280x160/111/222?text='+encodeURIComponent(channel.nombre)}" 
               alt="${channel.nombre}" loading="lazy" onerror="this.src='https://via.placeholder.com/280x160/000/666?text=XDXX'"/>
          <div class="title">${channel.nombre}</div>
        `;

        card.addEventListener('click', () => {
          document.querySelectorAll('.channel-card').forEach(el => el.classList.remove('active'));
          card.classList.add('active');
          loadStream(channel.url);
        });

        grid.appendChild(card);
      });

      categoriesContainer.appendChild(grid);
    });
  } catch (err) {
    categoriesContainer.innerHTML = `<p style="color:#ff0066; text-align:center; font-size:1.8rem;">⚠️ Error al cargar los canales. Refresca la página.</p>`;
  }
}

function loadStream(url) {
  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(player.media);
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      player.play().catch(() => console.log("Autoplay bloqueado"));
    });
  } else if (player.media.canPlayType('application/vnd.apple.mpegurl')) {
    player.source = { type: 'application/x-mpegURL', src: url };
    player.play().catch(() => {});
  } else {
    alert("Tu navegador no soporta este formato de stream.");
  }
}

// AGE GATE LOGIC
document.getElementById('enter').addEventListener('click', () => {
  localStorage.setItem('xdxxAgeVerified', 'true');
  document.getElementById('age-gate').style.display = 'none';
  document.getElementById('main-content').style.display = 'block';
  loadChannels();
});

document.getElementById('exit').addEventListener('click', () => {
  window.location.href = 'https://www.google.com';
});

// Si ya verificó edad
if (localStorage.getItem('xdxxAgeVerified') === 'true') {
  document.getElementById('age-gate').style.display = 'none';
  document.getElementById('main-content').style.display = 'block';
  loadChannels();
}
</script>
</body>
</html>
